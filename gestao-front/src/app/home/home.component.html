<mat-card class="home-card">
  <h1>Menu Principal</h1>
  <div class="actions">
    <button mat-raised-button color="warn" routerLink="/fornecedor-produtos">
      <mat-icon>search</mat-icon>
      Consultar Produtos Fornecedor
    </button>
    <button mat-raised-button color="primary" routerLink="/products">
      <mat-icon>inventory_2</mat-icon>
      Gerenciar Produtos
    </button>
    <button mat-raised-button color="primary" routerLink="/clientes">Listar Clientes</button>
    <button mat-raised-button color="accent" routerLink="/clientes/new">Cadastrar Cliente</button>
    <button mat-raised-button color="primary" routerLink="/empresa">Listar Empresas</button>
    <button mat-raised-button color="accent" routerLink="/empresa/new">Cadastrar Empresa</button>
    <button mat-raised-button color="primary" routerLink="/funcionario">Listar Funcionários</button>
    <button mat-raised-button color="accent" routerLink="/funcionario/new">Cadastrar Funcionário</button>
    <button mat-raised-button color="primary" routerLink="/vendas">Listar Vendas</button>
    <button mat-raised-button color="accent" routerLink="/vendas/new">Cadastrar Venda</button>
    <button mat-raised-button color="primary" routerLink="/fornecedor">Listar Fornecedor</button>
    <button mat-raised-button color="accent" routerLink="/fornecedor/new">Cadastrar Fornecedor</button>
  </div>
</mat-card>

<div class="dashboard-container" *ngIf="!isLoading">
  <mat-card class="dashboard-card" *ngFor="let card of dashboardCards">
    <mat-card-header [routerLink]="card.link">
      <div mat-card-avatar><mat-icon>{{card.icon}}</mat-icon></div>
      <mat-card-title>{{card.title}}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="count-section" [routerLink]="card.link">
        <p class="count">{{card.count}}</p>
        <p>Registrados</p>
      </div>
      
      <mat-divider></mat-divider>
      <div class="recent-items-container">
        <h4 class="recent-items-title">Últimos cadastros:</h4>
        <ng-container *ngIf="card.recentItems.length > 0; else noRecentItems">
          <ul class="recent-items-list">
            <li *ngFor="let item of card.recentItems">
              {{ item.nome || item.name || (item.idVenda ? 'Venda ' + item.idVenda : 'Item sem nome') }}
            </li>
          </ul>
        </ng-container>
        <ng-template #noRecentItems>
          <p class="no-items-message">Nenhum cadastro recente.</p>
        </ng-template>
      </div>
      </mat-card-content>
  </mat-card>
</div>

<mat-card class="home-card" *ngIf="!isLoadingStats">
  <mat-card-title>Vendas por Mês (Ano Corrente)</mat-card-title>
  <mat-card-content>
    <div class="stats-container">
      <div *ngFor="let stat of monthlyStats" class="stat-item">
        <h4>{{ stat.monthName }}</h4>
        <p><strong>Vendas:</strong> {{ stat.numero_vendas }}</p>
        <p><strong>Total:</strong> {{ stat.valor_total_vendas | currency:'BRL' }}</p>
      </div>
    </div>
  </mat-card-content>
</mat-card>

<mat-card class="home-card">
  <mat-card-title>Produtos com Menor Estoque</mat-card-title>
  <mat-card-content *ngIf="!isLoadingProducts">
    <div *ngIf="lowStockProducts.length > 0; else noProducts" class="table-container">
      <table mat-table [dataSource]="lowStockProducts" class="low-stock-table">

        <ng-container matColumnDef="nome_produto">
          <th mat-header-cell *matHeaderCellDef> Produto </th>
          <td mat-cell *matCellDef="let product"> {{product.nome_produto}} </td>
        </ng-container>

        <ng-container matColumnDef="qtd_produto">
          <th mat-header-cell *matHeaderCellDef> Quantidade em Estoque </th>
          <td mat-cell *matCellDef="let product" [class.low-stock]="product.qtd_produto < 10" [class.very-low-stock]="product.qtd_produto === 0"> 
            {{product.qtd_produto}} 
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>
    <ng-template #noProducts>
      <p>Nenhum produto com baixo estoque encontrado.</p>
    </ng-template>
  </mat-card-content>
  <div *ngIf="isLoadingProducts" class="loading-container">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      <p>Carregando produtos...</p>
  </div>
</mat-card>

<div *ngIf="isLoading || isLoadingStats" class="loading-overlay">
  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  <p>Carregando dados...</p>
</div>